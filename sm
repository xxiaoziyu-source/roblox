local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- 创建主屏幕GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SMPanel"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- 根据图片样式创建左侧菜单
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 250, 1, -40) -- 左侧菜单，高度几乎全屏
mainFrame.Position = UDim2.new(0, 10, 0, 20) -- 左侧位置
mainFrame.AnchorPoint = Vector2.new(0, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
mainFrame.BackgroundTransparency = 0.1 -- 半透明效果
mainFrame.BorderSizePixel = 0

-- 圆角
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- 彩色渐变边框（更明显的效果）
local borderContainer = Instance.new("Frame")
borderContainer.Name = "BorderContainer"
borderContainer.Size = UDim2.new(1, 6, 1, 6)
borderContainer.Position = UDim2.new(0, -3, 0, -3)
borderContainer.BackgroundTransparency = 1
borderContainer.BorderSizePixel = 0

-- 更鲜艳的渐变颜色
local colors = {
    Color3.fromRGB(255, 0, 0),      -- 红色
    Color3.fromRGB(255, 100, 0),    -- 橙色
    Color3.fromRGB(0, 255, 0),      -- 绿色
    Color3.fromRGB(0, 150, 255),    -- 蓝色
    Color3.fromRGB(200, 0, 255)     -- 紫色
}

for i = 1, 4 do
    local borderFrame = Instance.new("Frame")
    borderFrame.Name = "Border"..i
    borderFrame.BackgroundColor3 = colors[((i-1) % #colors) + 1]
    borderFrame.BorderSizePixel = 0
    borderFrame.ZIndex = 0
    
    if i == 1 then -- 上边框
        borderFrame.Size = UDim2.new(1, 0, 0, 3)
        borderFrame.Position = UDim2.new(0, 0, 0, -3)
    elseif i == 2 then -- 右边框
        borderFrame.Size = UDim2.new(0, 3, 1, 0)
        borderFrame.Position = UDim2.new(1, 0, 0, 0)
    elseif i == 3 then -- 下边框
        borderFrame.Size = UDim2.new(1, 0, 0, 3)
        borderFrame.Position = UDim2.new(0, 0, 1, 0)
    elseif i == 4 then -- 左边框
        borderFrame.Size = UDim2.new(0, 3, 1, 0)
        borderFrame.Position = UDim2.new(0, -3, 0, 0)
    end
    
    borderFrame.Parent = borderContainer
end

borderContainer.Parent = mainFrame

-- 标题栏（根据图片样式）
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
titleBar.BorderSizePixel = 0

local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, -10, 1, 0)
titleLabel.Position = UDim2.new(0, 10, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "SM脚本付费版"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 14
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = titleBar

-- 移动按钮
local moveButton = Instance.new("TextButton")
moveButton.Name = "MoveButton"
moveButton.Size = UDim2.new(0, 60, 0, 20)
moveButton.Position = UDim2.new(1, -70, 0, 5)
moveButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
moveButton.Text = "移动"
moveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
moveButton.TextSize = 12
moveButton.Font = Enum.Font.Gotham

local moveCorner = Instance.new("UICorner")
moveCorner.CornerRadius = UDim.new(0, 4)
moveCorner.Parent = moveButton
moveButton.Parent = titleBar

-- 服务器列表（根据图片中的顺序）
local servers = {
    "2.森林中的77个白天",
    "3.旮旯game", 
    "4.伐木大亨8",
    "5.枪刃球",
    "6.dog",
    "7.墨水派对",
    "91大帝"  -- 根据图片添加
}

local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Name = "ServerList"
scrollFrame.Size = UDim2.new(1, -10, 1, -150)
scrollFrame.Position = UDim2.new(0, 5, 0, 40)
scrollFrame.BackgroundTransparency = 1
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 4
scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 120)

-- 创建服务器按钮
local buttonHeight = 35
local padding = 5
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, #servers * (buttonHeight + padding))

for i, serverName in ipairs(servers) do
    local button = Instance.new("TextButton")
    button.Name = "ServerButton" .. i
    button.Size = UDim2.new(1, 0, 0, buttonHeight)
    button.Position = UDim2.new(0, 0, 0, (i-1) * (buttonHeight + padding))
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    button.Text = serverName
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 12
    button.Font = Enum.Font.Gotham
    button.AutoButtonColor = true
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 6)
    buttonCorner.Parent = button
    
    -- 点击按钮显示密钥错误信息
    button.MouseButton1Click:Connect(function()
        -- 显示错误消息
        showKeyErrorMessage("你没有购买该服务器的密钥，无法使用！")
        
        -- 3秒后踢出服务器
        wait(3)
        player:Kick("未购买密钥，请购买后重新加入。")
    end)
    
    button.Parent = scrollFrame
end

-- 底部信息区域（根据图片样式）
local bottomInfo = Instance.new("Frame")
bottomInfo.Name = "BottomInfo"
bottomInfo.Size = UDim2.new(1, -10, 0, 100)
bottomInfo.Position = UDim2.new(0, 5, 1, -110)
bottomInfo.BackgroundTransparency = 1

-- Classes 信息
local classesLabel = Instance.new("TextLabel")
classesLabel.Name = "ClassesLabel"
classesLabel.Size = UDim2.new(0.5, 0, 0, 20)
classesLabel.Position = UDim2.new(0, 0, 0, 0)
classesLabel.BackgroundTransparency = 1
classesLabel.Text = "classes"
classesLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
classesLabel.TextSize = 12
classesLabel.Font = Enum.Font.Gotham
classesLabel.TextXAlignment = Enum.TextXAlignment.Left
classesLabel.Parent = bottomInfo

local classesValue = Instance.new("TextLabel")
classesValue.Name = "ClassesValue"
classesValue.Size = UDim2.new(0.5, 0, 0, 20)
classesValue.Position = UDim2.new(0.5, 0, 0, 0)
classesValue.BackgroundTransparency = 1
classesValue.Text = "179855 | 394"
classesValue.TextColor3 = Color3.fromRGB(255, 255, 255)
classesValue.TextSize = 12
classesValue.Font = Enum.Font.GothamBold
classesValue.TextXAlignment = Enum.TextXAlignment.Right
classesValue.Parent = bottomInfo

-- Sold Out 信息
local soldOutLabel = Instance.new("TextLabel")
soldOutLabel.Name = "SoldOutLabel"
soldOutLabel.Size = UDim2.new(1, 0, 0, 20)
soldOutLabel.Position = UDim2.new(0, 0, 1, -20)
soldOutLabel.BackgroundTransparency = 1
soldOutLabel.Text = "Sold Out!"
soldOutLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
soldOutLabel.TextSize = 14
soldOutLabel.Font = Enum.Font.GothamBold
soldOutLabel.TextXAlignment = Enum.TextXAlignment.Left
soldOutLabel.Parent = bottomInfo

bottomInfo.Parent = mainFrame
scrollFrame.Parent = mainFrame
titleBar.Parent = mainFrame
mainFrame.Parent = screenGui
screenGui.Parent = playerGui

-- 显示密钥错误消息的函数
local function showKeyErrorMessage(message)
    local errorFrame = Instance.new("Frame")
    errorFrame.Name = "ErrorMessage"
    errorFrame.Size = UDim2.new(0, 300, 0, 100)
    errorFrame.Position = UDim2.new(0.5, -150, 0.5, -50)
    errorFrame.BackgroundColor3 = Color3.fromRGB(40, 20, 20)
    errorFrame.BorderSizePixel = 0
    errorFrame.ZIndex = 10
    
    local errorCorner = Instance.new("UICorner")
    errorCorner.CornerRadius = UDim.new(0, 8)
    errorCorner.Parent = errorFrame
    
    local errorLabel = Instance.new("TextLabel")
    errorLabel.Size = UDim2.new(1, -20, 0.6, 0)
    errorLabel.Position = UDim2.new(0, 10, 0.2, 0)
    errorLabel.BackgroundTransparency = 1
    errorLabel.Text = message
    errorLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    errorLabel.TextSize = 14
    errorLabel.Font = Enum.Font.GothamBold
    errorLabel.TextWrapped = true
    errorLabel.Parent = errorFrame
    
    local countdownLabel = Instance.new("TextLabel")
    countdownLabel.Size = UDim2.new(1, -20, 0.3, 0)
    countdownLabel.Position = UDim2.new(0, 10, 0.7, 0)
    countdownLabel.BackgroundTransparency = 1
    countdownLabel.Text = "3秒后将你踢出服务器..."
    countdownLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
    countdownLabel.TextSize = 12
    countdownLabel.Font = Enum.Font.Gotham
    countdownLabel.Parent = errorFrame
    
    errorFrame.Parent = screenGui
    
    -- 3秒后自动移除错误消息
    delay(3, function()
        errorFrame:Destroy()
    end)
end

-- 边框颜色动画（更明显的效果）
local function animateBorders()
    local time = 0
    RunService.Heartbeat:Connect(function(delta)
        time = time + delta
        
        for i, borderFrame in ipairs(borderContainer:GetChildren()) do
            if borderFrame:IsA("Frame") then
                local colorIndex = ((math.floor(time * 3) + i - 1) % #colors) + 1
                local nextColorIndex = (colorIndex % #colors) + 1
                local t = (time * 3) % 1
                
                borderFrame.BackgroundColor3 = colors[colorIndex]:Lerp(colors[nextColorIndex], t)
            end
        end
    end)
end

-- 移动功能
local isMoving = false
local dragStartPos
local dragStartFramePos

moveButton.MouseButton1Click:Connect(function()
    isMoving = not isMoving
    if isMoving then
        moveButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
        moveButton.Text = "移动中..."
    else
        moveButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        moveButton.Text = "移动"
    end
end)

-- 拖拽移动功能
local function onInput(input, gameProcessed)
    if gameProcessed or not isMoving then return end
    
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        if input.UserInputState == Enum.UserInputState.Begin then
            dragStartPos = input.Position
            dragStartFramePos = mainFrame.Position
        elseif input.UserInputState == Enum.UserInputState.Change then
            local currentPos = input.Position
            local delta = currentPos - dragStartPos
            mainFrame.Position = UDim2.new(
                0, dragStartFramePos.X.Offset + delta.X,
                0, dragStartFramePos.Y.Offset + delta.Y
            )
        end
    end
end

UserInputService.InputBegan:Connect(onInput)
UserInputService.InputChanged:Connect(onInput)

-- 启动动画
animateBorders()

print("SM脚本面板已加载！点击服务器按钮会显示密钥错误并踢出玩家。")
