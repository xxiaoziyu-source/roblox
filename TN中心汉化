local Translations = {
    -- 验证界面
    ["Verification Required"] = "需要验证",
    ["Enter key here..."] = "在此处输入密钥...",
    ["Get Key"] = "获取密钥",
    ["Check Key"] = "检查密钥",
    ["Join Discord"] = "加入Discord",
    ["PLEASE: DON'T START SCRIPT IN PLAYERS LOBBY MAKE SURE YOU'RE IN THE GAME"] = "请注意：不要在玩家大厅启动脚本，确保你在游戏中",
    ["Enter key or get a new one"] = "输入密钥或获取新密钥",
 
    -- 信息（Information）标签页
    ["Important Information"] = "重要信息",
    ["Please read before using:"] = "使用前请阅读：",
    ["Day - Time Left: 2:19"] = "白天 - 剩余时间：2分19秒",
    ["Story Day: 1"] = "剧情天数：1",
    ["Cultist Attack Day: ×"] = "邪教徒攻击日：×",
    ["Stronghold Timer: Stronghold not found"] = "要塞计时器：未找到要塞",
    ["Fire Setup:"] = "火堆设置：",
    ["Make sure to upgrade your fire to maximum level."] = "确保将你的火堆升级到最高等级。",
    ["Items may glitch if you teleport them from unopened map areas to your location."] = "如果从未开启的地图区域将物品传送到你的位置，物品可能会出现故障。",
    ["Transport Options:"] = "传送选项：",
    ["Each transport feature has two destination options:"] = "每个传送功能有两个目的地选项：",
    ["· Player: Teleports items to your location"] = "· 玩家：将物品传送到你的位置",
    ["· Campfire/Scrapper: Teleports to the specified station"] = "· 营火/拆解器：传送到指定站点",
    ["Choose the option that works best for you!"] = "选择最适合你的选项！",
    ["Found issues or have ideas?"] = "发现问题或有想法？",
    ["Join the Discord community! You can find the link"] = "加入Discord社区！你可以找到链接",
    ["in the Credits section above."] = "在上方的致谢部分。",
    ["We welcome bug reports and feature suggestions!"] = "我们欢迎错误报告和功能建议！",
 
    -- 杂项（Misc）标签页
    ["Miscellaneous"] = "杂项",
    ["After turning it off make sure to visit the campfire to restart the real time lighting"] = "关闭后请务必前往营火以重新启动实时照明",
    ["Always Day Light"] = "始终白天",
    ["Performance Booster - Please note: Once you activate it, to disable you have to restart the game/server"] = "性能增强器 - 请注意：一旦激活，要禁用它你必须重新启动游戏/服务器",
    ["Performance Booster"] = "性能增强器",
    ["Instant Open Chests"] = "立即打开宝箱",
    ["Map Revealing - Please make sure to max the campfire first, it would be much better"] = "地图显示 - 请务必先将营火升到满级，这样会好得多",
    ["Teleport Cooldown"] = "传送冷却时间",
    ["Reveal All Map"] = "显示全部地图",
 
    -- 玩家（Player）标签页
    ["Player Settings"] = "玩家设置",
    ["Enable Speed"] = "启用速度",
    ["Speed Value"] = "速度值",
    ["Enable Jump"] = "启用跳跃",
    ["Jump Power"] = "跳跃力",
    ["Fly Mode"] = "飞行模式",
    ["Fly Speed"] = "飞行速度",
    ["Important Places Teleportation:"] = "重要地点传送：",
    ["If teleportation doesn't work, try revealing the map first as some locations"] = "如果传送不起作用，请先尝试显示地图，因为某些位置",
 
    -- 战斗（Combat）标签页
    ["Auto Attack"] = "自动攻击",
    ["Enable Auto Attack"] = "启用自动攻击",
    ["Weapon Type"] = "武器类型",
    ["Target Type"] = "目标类型",
    ["Ultra Kill"] = "极限击杀",
    ["Attack Range"] = "攻击范围",
    ["Instant Reload"] = "立即装填",
    ["Reload Time"] = "装填时间",
 
    -- 树木（Trees）标签页
    ["Tree Cutting"] = "树木砍伐",
    ["Enable Auto Tree Chopping"] = "启用自动砍树",
    ["Ultra Tree Chopping"] = "极限砍树",
    ["Chopping Range"] = "砍伐范围",
    ["Target Tree Type"] = "目标树木类型",
    ["Ultra Chop Tree Count"] = "极限砍伐树木数量",
 
    -- 其他标签
    ["Meteors"] = "陨石",
    ["Campfire"] = "营火",
    ["Crafting"] = "制作",
    ["Food"] = "食物",

    -- 新增未汉化内容
    ["Player: Teleports items to your location"] = "· 玩家：将物品传送到你的位置",
    ["Scrapper"] = "拆解器",
    ["Found issues or have ideas?"] = "发现问题或有想法？",
    ["Credits"] = "致谢",
    ["Cultist Attack Day:"] = "邪教徒攻击日：",
    ["Every Tree"] = "所有树木",
    ["Small Tree"] = "小树",
    ["Snowy Small Tree"] = "积雪小树",
    ["Show 99NF"] = "显示 99NF",
    ["Interface Hidden"] = "界面已隐藏",
    ["The interface has been hidden, you can unhide the interface by tapping 'Show'."] = "界面已隐藏，你可以通过点击“显示”来取消隐藏界面。",
    ["ToastyXD Hub"] = "TXD 中心--○○汉化",
    -- 新增未汉化内容
    ["Machine"] = "机器",
    ["Transport To:"] = "传送至：",
    ["Teleport Height"] = "传送高度",
    ["studs"] = " studs（单位）",
    ["Tip:"] = "提示：",
    ["Use Transport To: Player if you encounter issues with the scrapper"] = "如果拆解器出现问题，请使用传送至：玩家",
    ["Produce Scrap"] = "生产废料",
    ["Scrap Item Type"] = "废料物品类型",
    ["Produce Wood (⚠️ Use only one option)"] = "生产木材（⚠️ 仅使用一个选项）",
    ["Enable 食物 Transporter"] = "启用食物传送器",
    ["Transport Wait Time"] = "传送等待时间",
    ["食物 Type"] = "食物类型",
    ["Healing Items Transport"] = "治疗物品传送",
    ["Enable Healing Items Transporter"] = "启用治疗物品传送器",
    ["Healing Item Type"] = "治疗物品类型",
    ["Bandage"] = "绷带",
    ["Auto Safe Place"] = "自动安全放置",
    ["Health Threshold"] = "生命阈值",
    ["HP"] = "生命值",
    ["Animal Pelts Transport"] = "动物皮毛传送",
    ["Enable Animal Pelts Transporter"] = "启用动物皮毛传送器",
    ["Animal Pelt Type"] = "动物皮毛类型",
    ["Bunny Foot"] = "兔子脚",
    ["Animal Pelts"] = "动物皮毛",
    ["Healing"] = "治疗",
    ["Weapons & Ammo"] = "武器与弹药",
    ["Chests"] = "宝箱",
    ["Success! Loading script..."] = "成功！正在加载脚本...",
    ["Items may glitch if you teleport them from unopened map areas to your location."] = "如果从未开启的地图区域将物品传送到你的位置，物品可能会出现故障。"
}

local function translateText(text)
    if not text or type(text) ~= "string" then return text end
    
    if Translations[text] then
        return Translations[text]
    end
    
    for en, cn in pairs(Translations) do
        if text:find(en) then
            return text:gsub(en, cn)
        end
    end
    
    return text
end

local function setupTranslationEngine()
    local success, err = pcall(function()
        local oldIndex = getrawmetatable(game).__newindex
        setreadonly(getrawmetatable(game), false)
        
        getrawmetatable(game).__newindex = newcclosure(function(t, k, v)
            if (t:IsA("TextLabel") or t:IsA("TextButton") or t:IsA("TextBox")) and k == "Text" then
                v = translateText(tostring(v))
            end
            return oldIndex(t, k, v)
        end)
        
        setreadonly(getrawmetatable(game), true)
    end)
    
    if not success then
        warn("元表劫持失败:", err)
       
        local translated = {}
        local function scanAndTranslate()
            for _, gui in ipairs(game:GetService("CoreGui"):GetDescendants()) do
                if (gui:IsA("TextLabel") or gui:IsA("TextButton") or gui:IsA("TextBox")) and not translated[gui] then
                    pcall(function()
                        local text = gui.Text
                        if text and text ~= "" then
                            local translatedText = translateText(text)
                            if translatedText ~= text then
                                gui.Text = translatedText
                                translated[gui] = true
                            end
                        end
                    end)
                end
            end
            
            local player = game:GetService("Players").LocalPlayer
            if player and player:FindFirstChild("PlayerGui") then
                for _, gui in ipairs(player.PlayerGui:GetDescendants()) do
                    if (gui:IsA("TextLabel") or gui:IsA("TextButton") or gui:IsA("TextBox")) and not translated[gui] then
                        pcall(function()
                            local text = gui.Text
                            if text and text ~= "" then
                                local translatedText = translateText(text)
                                if translatedText ~= text then
                                    gui.Text = translatedText
                                    translated[gui] = true
                                end
                            end
                        end)
                    end
                end
            end
        end
        
        local function setupDescendantListener(parent)
            parent.DescendantAdded:Connect(function(descendant)
                if descendant:IsA("TextLabel") or descendant:IsA("TextButton") or descendant:IsA("TextBox") then
                    task.wait(0.1)
                    pcall(function()
                        local text = descendant.Text
                        if text and text ~= "" then
                            local translatedText = translateText(text)
                            if translatedText ~= text then
                                descendant.Text = translatedText
                            end
                        end
                    end)
                end
            end)
        end
        
        pcall(setupDescendantListener, game:GetService("CoreGui"))
        local player = game:GetService("Players").LocalPlayer
        if player and player:FindFirstChild("PlayerGui") then
            pcall(setupDescendantListener, player.PlayerGui)
        end
        
        while true do
            scanAndTranslate()
            task.wait(3)
        end
    end
end

task.wait(2)

setupTranslationEngine()

local success, err = pcall(function()
--这下面填加载外部脚本
loadstring(game:HttpGet("https://raw.githubusercontent.com/nouralddin-abdullah/99-night/refs/heads/main/main-en.lua"))()


end)

if not success then
    warn("加载失败:", err)
end
